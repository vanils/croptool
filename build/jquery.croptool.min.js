/*
 *
 * jQuery Croptool v1.0.0
 * http://github.com/vanils/croptool
 *
 * Copyright 2014, Matti Mehtonen
 * Licensed under the MIT license.
 * http://github.com/vanils/croptool/blob/master/LICENSE
 *
 */
!function(a,b,c){"use strict";var d;d=function(a,b){this.options=b,this.mode=d.MODE_NORMAL,this.state=d.STATE_NULL,this.direction=d.DIRECTION_BOTH,this.createDOM(a),this.attachListeners()},d.MODE_CENTER=1,d.MODE_NORMAL=2,d.STATE_NULL=3,d.STATE_MOVE=4,d.STATE_RESIZE=5,d.DIRECTION_VERTICAL=6,d.DIRECTION_HORIZONTAL=7,d.DIRECTION_BOTH=8,d.defaults={aspectRatio:void 0,disabled:!1,dragPoints:!0,keyboard:!0,margin:.01,maxWidth:void 0,maxHeight:void 0,minWidth:0,minHeight:0,movable:!0,persistent:!0,resizable:!0,trueWidth:void 0,trueHeight:void 0,x:void 0,y:void 0,width:void 0,height:void 0,change:void 0,end:void 0,start:void 0},d.template=function(){var a,c,d=b.createElement("div"),e=b.createElement("div"),f=b.createElement("div"),g=b.createElement("div"),h="top|top-right|right|bottom-right|bottom|bottom-left|left|top-left".split("|"),i="croptool-";for(d.className=i+"container",e.className=i+"selection",f.className=i+"remnant",g.className=i+"point",c=0;4>c;c++)a=f.cloneNode(!1),a.className+=" "+i+"remnant-"+h[2*c],e.appendChild(a);for(c=0;8>c;c++)a=g.cloneNode(!1),a.className+=" "+i+"point-"+h[c],e.appendChild(a);return d.appendChild(e),d}(),d.getPointFromEvent=function(a){var b,c=a.type,d={};return"touchstart"===c?(b=a.touches,d.x=b[0].pageX,d.y=b[0].pageY):"touchmove"===c?(b=a.touches,d.x=b[0].pageX,d.y=b[0].pageY):"touchend"===c?(b=a.changedTouches,d.x=b[0].pageX,d.y=b[0].pageY):(d.x=a.pageX,d.y=a.pageY),d},d.prototype.createDOM=function(a){var b,e=c(a),f=c(d.template.cloneNode(!0)),g=c(".croptool-selection",f);this.elements={$container:f,$selection:g,container:f[0],selection:g[0]},e.parent().append(f),f.append(e),b=g.css("outline-width"),b?parseInt(b,10)||g.addClass("no-outline"):g.addClass("no-outline")},d.prototype.attachListeners=function(){var b=c(a),e=c("body"),f=this;b.on("keydown",function(a){18===a.which&&(f.mode=d.MODE_CENTER,f.state!==d.STATE_NULL&&f.updateSelection())}),b.on("keyup",function(a){18===a.which&&(f.mode=d.MODE_NORMAL,f.state!==d.STATE_NULL&&f.updateSelection())}),e.on("mousedown",function(a){f.dragStart(a)}),e.on("mousemove",function(a){f.dragMove(a)}),e.on("mouseup",function(a){f.dragEnd(a)})},d.prototype.pointToPercents=function(a){var b=this.elements.$container.offset();return{x:(a.x-b.left)/this.elements.container.offsetWidth,y:(a.y-b.top)/this.elements.container.offsetHeight}},d.prototype.testHitPoint=function(a){var b=this.selection;return a.y<b.y-b.m||a.y>b.y+b.h+b.m?!1:a.x<b.x-b.m||a.x>b.x+b.w+b.m?!1:!0},d.prototype.getOrigin=function(a){var b,c,d=this.selection,e=this.options.margin;return a.x>=d.x-e&&a.x<=d.x+e?b=1:a.x>=d.x+d.w-e&&a.x<=d.x+d.w+e&&(b=0),a.y>=d.y-e&&a.y<=d.y+e?c=1:a.y>=d.y+d.h-e&&a.y<=d.y+d.h+e&&(c=0),{x:b,y:c}},d.prototype.applyOrigin=function(a){var b=a.x,c=a.y;return"undefined"==typeof b&&"undefined"==typeof c?void(this.state=d.STATE_MOVE):(this.state=d.STATE_RESIZE,void(this.direction="undefined"!=typeof b&&"undefined"!=typeof c?d.DIRECTION_BOTH:"undefined"!=typeof b?d.DIRECTION_HORIZONTAL:d.DIRECTION_VERTICAL))},d.prototype.getCursor=function(a){return a?"undefined"==typeof a.x?"undefined"==typeof a.y?"move":"ns-resize":a.x?"undefined"==typeof a.y?"ew-resize":a.y?"nwse-resize":"nesw-resize":"undefined"==typeof a.y?"ew-resize":a.y?"nesw-resize":"nwse-resize":"default"},d.prototype.setCursor=function(a){this.cursor!==a&&(this.elements.$container.css("cursor",a),this.cursor=a)},d.prototype.selection={x:.23,y:.23,w:.67,h:.56},d.prototype.drag={},d.prototype.dragStart=function(a){var b,c=this.pointToPercents(d.getPointFromEvent(a));this.mode=a.altKey?d.MODE_CENTER:d.MODE_NORMAL,this.testHitPoint(c)&&(a.preventDefault(),b=this.getOrigin(c),this.applyOrigin(b),this.state===d.STATE_MOVE?(this.drag.point={x:c.x,y:c.y},this.drag.init={x:c.x,y:c.y},this.drag.original={x:this.selection.x,y:this.selection.y}):(this.drag.point={x:c.x,y:c.y},this.drag.end=function(a){var c,d;return"undefined"!=typeof b.x&&(c=a.selection.x+a.selection.w*b.x),"undefined"!=typeof b.y&&(d=a.selection.y+a.selection.h*b.y),{x:c,y:d}}(this),this.drag.center=function(a){var c,d;return"undefined"!=typeof b.x&&(c=a.selection.x+.5*a.selection.w),"undefined"!=typeof b.y&&(d=a.selection.y+.5*a.selection.h),{x:c,y:d}}(this)),this.setCursor(this.getCursor(b)))},d.prototype.dragMove=function(a){var b=this.pointToPercents(d.getPointFromEvent(a));this.mode=a.altKey?d.MODE_CENTER:d.MODE_NORMAL,this.state===d.STATE_NULL?this.testHitPoint(b)&&this.setCursor(this.getCursor(this.getOrigin(b))):(a.preventDefault(),this.drag.point=b,this.updateSelection())},d.prototype.dragEnd=function(a){a.preventDefault(),this.mode=a.altKey?d.MODE_CENTER:d.MODE_NORMAL,this.state=d.STATE_NULL,this.setCursor(this.getCursor(this.getOrigin(this.pointToPercents(d.getPointFromEvent(a)))))},d.prototype.updateSelection=function(){var a,b,c=this.selection,e=this.drag;this.state===d.STATE_MOVE?(c.x=e.original.x+e.point.x-e.init.x,c.y=e.original.y+e.point.y-e.init.y):this.direction===d.DIRECTION_BOTH?(a=this.getDimension(d.DIRECTION_HORIZONTAL),b=this.getDimension(d.DIRECTION_VERTICAL),c.x=a.position,c.w=a.length,c.y=b.position,c.h=b.length):this.direction===d.DIRECTION_VERTICAL?(b=this.getDimension(d.DIRECTION_VERTICAL),c.y=b.position,c.h=b.length):(a=this.getDimension(d.DIRECTION_HORIZONTAL),c.x=a.position,c.w=a.length),this.elements.$selection.css("display","none"),this.elements.$selection.css("left",100*c.x+"%"),this.elements.$selection.css("top",100*c.y+"%"),this.elements.$selection.css("width",100*c.w+"%"),this.elements.$selection.css("height",100*c.h+"%"),this.elements.$selection.css("display","block")},d.prototype.getDimension=function(a){var b,c,e,f;return a===d.DIRECTION_HORIZONTAL?(b=this.drag.point.x,c=this.mode===d.MODE_NORMAL?this.drag.end.x:this.drag.center.x):(b=this.drag.point.y,c=this.mode===d.MODE_NORMAL?this.drag.end.y:this.drag.center.y),this.mode===d.MODE_NORMAL?b>c?(e=c,f=b-c):(e=b,f=c-b):b>c?(e=2*c-b,f=2*(b-c)):(e=b,f=2*(c-b)),{position:e,length:f}},c.croptool=function(a,b){if("string"==typeof a)switch(a){case"defaults":return"undefined"!=typeof b&&(d.defaults=c.extend(d.defaults,b)),d.defaults}},c.fn.croptool=function(a){var b;return"string"!=typeof a?(b=c.extend(d.defaults,a),this.each(function(){new d(this,b)})):void 0}}(window,document,window.jQuery);