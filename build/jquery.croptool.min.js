/*
 *
 * jQuery Croptool v1.0.0
 * http://github.com/vanils/croptool
 *
 * Copyright 2014, Matti Mehtonen
 * Licensed under the MIT license.
 * http://github.com/vanils/croptool/blob/master/LICENSE
 *
 */
!function(a,b,c){"use strict";var d;d=function(a,b){var e,f=c(a),g=c(d.template.cloneNode(!0)),h=c(".croptool-selection",g),i=c("body"),j=this;this.elements={container:g[0],$container:g,selection:h[0],$selection:h},this.options=b,f.parent().append(g),g.append(f),e=h.css("outline-width"),e?parseInt(e,10)||h.addClass("no-outline"):h.addClass("no-outline"),i.on("mousedown",function(a){j.dragStart(a)}),i.on("mousemove",function(a){j.dragMove(a)}),i.on("mouseup",function(a){j.dragEnd(a)})},d.DEFAULT=0,d.MOVE=1,d.RESIZE_VERTICAL=2,d.RESIZE_HORIZONTAL=3,d.RESIZE_BOTH=4,d.VERTICAL=5,d.HORIZONTAL=6,d.prototype.convert=function(a){var b=this.elements.$container.offset(),c=100*(a.x-b.left)/this.elements.container.offsetWidth,d=100*(a.y-b.top)/this.elements.container.offsetHeight;return{x:c>100?100:0>c?0:c,y:d>100?100:0>d?0:d}},d.prototype.getOrigin=function(a){var b,c,d=this.selection;return a.x>d.x-d.m&&a.x<d.x+d.m?b=100:a.x>d.x+d.w-d.m&&a.x<d.x+d.w+d.m?b=0:a.x>d.x&&a.x<d.x+d.w&&(b=50),a.y>d.y-d.m&&a.y<d.y+d.m?c=100:a.y>d.y+d.h-d.m&&a.y<d.y+d.h+d.m?c=0:a.y>d.y&&a.y<d.y+d.h&&(c=50),"undefined"!=typeof b&&"undefined"!=typeof c?{x:b,y:c}:void 0},d.prototype.getCursor=function(a){if(!a)return"default";var b=d.cursors,c="x"+a.x,e="y"+a.y;return b[c]&&b[c][e]},d.prototype.getState=function(a){return 50===a.x&&50===a.y?d.MOVE:50===a.x?d.RESIZE_VERTICAL:50===a.y?d.RESIZE_HOIZONTALR:d.RESIZE_BOTH},d.prototype.setCursor=function(a){this.selection.cursor!==a&&(this.elements.$container.css("cursor",a),this.selection.cursor=a)},d.prototype.validateSelection=function(){{var a=this.selection;this.drag}return a.w<0&&this.mirror(d.HORIZONTAL),a.h<0&&this.mirror(d.VERTICAL),a},d.prototype.mirror=function(a){var b,c,e,f=this.drag;switch(a===d.HORIZONTAL?(c=f.selection.w,b=f.origin.x,e="x"):(c=this.drag.selection.h,b=f.origin.y,e="y"),b){case 0:this.drag[e]+=c,this.drag.init[e]-=2*c,this.drag.selection[e]-=c,this.drag.origin[e]=100,this.selection[e]=f.selection[e]+c;break;case 50:this.drag[e]+=c,this.drag.init[e]-=2*c,this.drag.selection[e]-=c,this.drag.origin[e]=100,this.selection[e]=f.selection[e]+c;break;case 100:this.drag[e]-=c,this.drag.init[e]+=2*c,this.drag.selection[e]+=c,this.drag.origin[e]=0,this.selection[e]=f.selection[e]}},d.prototype.mirrorSelectionHorizontally=function(){var a=this.drag,b=this.drag.selection.w;switch(a.origin.x){case 0:this.drag.x+=b,this.drag.init.x-=2*b,this.drag.selection.x-=b,this.drag.origin.x=100,this.selection.x=a.selection.x+b;break;case 100:this.drag.x-=b,this.drag.init.x+=2*b,this.drag.selection.x+=b,this.drag.origin.x=0,this.selection.x=a.selection.x}},d.prototype.selection={m:1,x:23,y:23,w:67,h:56},d.prototype.drag={state:d.DEFAULT,cursor:"default",preserve:!1,aspectRatio:void 0,x:0,y:0,init:{x:0,y:0},selection:{m:0,x:0,y:0,w:0,h:0},origin:{x:0,y:0}},d.prototype.dragStart=function(a){a.preventDefault(),c.extend(this.drag,this.convert({x:a.pageX,y:a.pageY})),this.drag.init.x=this.drag.x,this.drag.init.y=this.drag.y,this.drag.selection=c.extend({},this.selection),this.drag.origin=this.getOrigin(this.drag),this.drag.state=this.getState(this.drag.origin),this.drag.cursor=this.getCursor(this.getOrigin(this.drag.init)),this.drag.aspectRatio=this.options.aspectRatio||this.selection.w/this.selection.h,this.setCursor(this.drag.cursor),a.altKey&&(this.drag.origin={x:50,y:50}),a.shiftKey&&(this.drag.preserve=!0)},d.prototype.dragMove=function(a){a.preventDefault(),this.drag.state!==d.DEFAULT&&(c.extend(this.drag,this.convert({x:a.pageX,y:a.pageY})),this.updateSelection()),this.setCursor(this.getCursor(this.getOrigin(this.convert({x:a.pageX,y:a.pageY}))))},d.prototype.dragEnd=function(a){a.preventDefault(),this.drag.state=d.DEFAULT,this.setCursor(this.getCursor(this.getOrigin(this.convert({x:a.pageX,y:a.pageY}))))},d.prototype.updateVerticalSelection=function(){var a=this.selection,b=this.drag;switch(b.origin.y){case 0:a.h=b.selection.h+b.y-b.init.y;break;case 50:b.init.y>b.selection.y+.5*b.selection.h?(a.y=b.selection.y+b.init.y-b.y,a.h=b.selection.h-2*(b.init.y-b.y)):(a.y=b.selection.y+b.y-b.init.y,a.h=b.selection.h+2*(b.init.y-b.y));break;case 100:a.y=b.selection.y+b.y-b.init.y,a.h=b.selection.h+b.init.y-b.y}},d.prototype.updateHorizontalSelection=function(){var a=this.selection,b=this.drag;switch(b.origin.x){case 0:a.w=b.selection.w+b.x-b.init.x;break;case 50:b.init.x>b.selection.x+.5*b.selection.w?(a.x=b.selection.x+b.init.x-b.x,a.w=b.selection.w-2*(b.init.x-b.x)):(a.x=b.selection.x+b.x-b.init.x,a.w=b.selection.w+2*(b.init.x-b.x));break;case 100:a.x=b.selection.x+b.x-b.init.x,a.w=b.selection.w+b.init.x-b.x}},d.prototype.updateSelection=function(){var a=this.selection,b=this.drag;switch(b.state){case d.MOVE:a.x=b.selection.x+b.x-b.init.x,a.y=b.selection.y+b.y-b.init.y;break;case d.RESIZE_VERTICAL:this.updateVerticalSelection();break;case d.RESIZE_HOIZONTALR:this.updateHorizontalSelection();break;case d.RESIZE_BOTH:this.updateVerticalSelection(),this.updateHorizontalSelection()}this.validateSelection(),this.elements.$selection.css("display","none"),this.elements.$selection.css("left",a.x+"%"),this.elements.$selection.css("top",a.y+"%"),this.elements.$selection.css("width",a.w+"%"),this.elements.$selection.css("height",a.h+"%"),this.elements.$selection.css("display","block")},d.defaults={aspectRatio:void 0,disabled:!1,dragPoints:!0,keyboard:!0,maxWidth:void 0,maxHeight:void 0,minWidth:0,minHeight:0,movable:!0,persistent:!0,resizable:!0,trueWidth:void 0,trueHeight:void 0,x:void 0,y:void 0,width:void 0,height:void 0,change:void 0,end:void 0,start:void 0},d.cursors={x0:{y0:"nwse-resize",y50:"ew-resize",y100:"nesw-resize"},x50:{y0:"ns-resize",y50:"move",y100:"ns-resize"},x100:{y0:"nesw-resize",y50:"ew-resize",y100:"nwse-resize"}},d.template=function(){var a,c,d=b.createElement("div"),e=b.createElement("div"),f=b.createElement("div"),g=b.createElement("div"),h=["top","top-right","right","bottom-right","bottom","bottom-left","left","top-left"];for(d.className="croptool-container",e.className="croptool-selection",f.className="croptool-remnant",g.className="croptool-point",c=0;4>c;c++)a=f.cloneNode(!1),a.className+=" croptool-remnant-"+h[2*c],e.appendChild(a);for(c=0;8>c;c++)a=g.cloneNode(!1),a.className+=" croptool-point-"+h[c],e.appendChild(a);return d.appendChild(e),d}(),c.croptool=function(a,b){if("string"==typeof a)switch(a){case"defaults":return"undefined"!=typeof b&&(d.defaults=c.extend(d.defaults,b)),d.defaults}},c.fn.croptool=function(a){var b;return"string"!=typeof a?(b=c.extend(d.defaults,a),this.each(function(){new d(this,b)})):void 0}}(window,document,window.jQuery);